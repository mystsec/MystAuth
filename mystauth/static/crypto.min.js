async function checkSupport(t){if(window.PublicKeyCredential){if(t){return!!await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}return!0}return!1}function ab2str(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function str2ab(t){const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let e=0,r=t.length;e<r;e++)n[e]=t.charCodeAt(e);return e}function ab2b64(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,a=0;a<r;a++)e+=String.fromCharCode(n[a]);return window.btoa(e)}function b642ab(t){for(var e=atob(t),n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n.buffer}function encode_utf8(t){return unescape(encodeURIComponent(t))}function decode_utf8(t){return decodeURIComponent(escape(t))}function decodeU8A(t){return(new TextDecoder).decode(t)}function base64decode(t){let e=atob(t).replace(/[\x80-\uffff]/g,(t=>`%${t.charCodeAt(0).toString(16).padStart(2,"0")}`));return decodeURIComponent(e)}function decodeBase64(t){var e,n,r,a={},o=0,i=0,c="",s=String.fromCharCode,b=t.length;for(e=0;e<64;e++)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(e)]=e;for(n=0;n<b;n++)for(o=(o<<6)+a[t.charAt(n)],i+=6;i>=8;)((r=o>>>(i-=8)&255)||n<b-2)&&(c+=s(r));return c}function b64_to_b64url(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function b64url_to_b64(t){var e=(t=t.replace(/-/g,"+").replace(/_/g,"/")).length%4;if(e){if(1===e)throw new Error("InvalidLengthError: Input string is the wrong length for base64 padding");t+=new Array(5-e).join("=")}return t}function td2int(e){t=e[1],d=e[2];let n=t.split(":"),r=d.split("-"),a=3600*parseInt(n[0])+60*parseInt(n[1])+parseInt(n[2]);return[365*(parseInt(r[0])-2020)+30*parseInt(r[1])+parseInt(r[2]),a]}async function decodeFData(t,e,n){let r=await RSA_DECRYPT(t,n);r=r.split(":");let a=r[0],o=r[1];return await AES_DECRYPT(e,a,o)}async function AES_ENCRYPT(t,e){return new Promise(((n,r)=>{let a=window.crypto.getRandomValues(new Uint8Array(128));window.crypto.subtle.importKey("raw",str2ab(atob(b64url_to_b64(t))),"AES-GCM",!1,["encrypt"]).then((async t=>{await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},t,str2ab(e)).then((t=>{a=btoa(ab2str(a)),n([btoa(ab2str(t)),a])}))}))}))}async function AES_DECRYPT(t,e,n){return new Promise(((r,a)=>{n=str2ab(atob(b64url_to_b64(n))),window.crypto.subtle.importKey("raw",str2ab(atob(b64url_to_b64(t))),"AES-GCM",!1,["decrypt"]).then((async t=>{await window.crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,str2ab(atob(b64url_to_b64(e)))).then((t=>{r(ab2str(t))}))}))}))}async function generate_AES_KEY(){let t=window.crypto.getRandomValues(new Uint8Array(128)),e=window.crypto.getRandomValues(new Uint8Array(64));return new Promise((async(n,r)=>{await window.crypto.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]).then((async r=>{await window.crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e6,hash:"SHA-512"},r,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]).then((async r=>{await window.crypto.subtle.exportKey("raw",r).then((function(r){n([btoa(ab2str(r)),btoa(ab2str(t)),btoa(ab2str(e))])}))}))}))}))}async function derive_AES_KEY(t,e){let n=str2ab(atob(b64url_to_b64(t))),r=str2ab(atob(b64url_to_b64(e)));return new Promise((async(t,e)=>{await window.crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveKey"]).then((async e=>{await window.crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e6,hash:"SHA-512"},e,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]).then((async e=>{await window.crypto.subtle.exportKey("raw",e).then((function(e){t(btoa(ab2str(e)))}))}))}))}))}async function generate_RSA_KEY(){return new Promise((async(t,e)=>{window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"]).then((async e=>{await window.crypto.subtle.exportKey("jwk",e.publicKey).then((async function(n){let r=JSON.stringify(n),a=b64_to_b64url(window.btoa(r));await window.crypto.subtle.exportKey("pkcs8",e.privateKey).then((async function(e){const n=ab2str(e),r=b64_to_b64url(window.btoa(n));t([a,r])}))}))}))}))}async function RSA_ENCRYPT(t,e){return new Promise(((n,r)=>{let a=str2ab(e);window.crypto.subtle.importKey("jwk",JSON.parse(window.atob(b64url_to_b64(t))),{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"]).then((async t=>{await window.crypto.subtle.encrypt({name:"RSA-OAEP"},t,a).then((t=>{n(btoa(ab2str(t)))}))}))}))}async function RSA_DECRYPT(t,e){return new Promise(((n,r)=>{let a=str2ab(atob(b64url_to_b64(e)));window.crypto.subtle.importKey("pkcs8",str2ab(window.atob(b64url_to_b64(t))),{name:"RSA-OAEP",hash:"SHA-256"},!1,["decrypt"]).then((async t=>{await window.crypto.subtle.decrypt({name:"RSA-OAEP"},t,a).then((t=>{n(ab2str(t))}))}))}))}
